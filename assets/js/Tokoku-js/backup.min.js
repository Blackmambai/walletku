document.addEventListener("DOMContentLoaded",(()=>{const e=document.getElementById("btnBackup"),t=document.getElementById("btnImport"),a=document.getElementById("btnReset"),n=document.getElementById("fileImport");e.addEventListener("click",(()=>{const e={produk:JSON.parse(localStorage.getItem("produk")||"[]"),nota:JSON.parse(localStorage.getItem("nota")||"[]"),pengaturanToko:JSON.parse(localStorage.getItem("pengaturanToko")||"{}")},t=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),a=URL.createObjectURL(t),n=document.createElement("a");n.href=a;const o=new Date,r=`${o.getFullYear()}/${String(o.getMonth()+1).padStart(2,"0")}/${String(o.getDate()).padStart(2,"0")}`;n.download=`backup_${r}.json`,document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(a),Swal.fire({title:"Backup Berhasil",text:"Data telah berhasil di-backup",icon:"success",confirmButtonText:"OK"})})),t.addEventListener("click",(()=>{n.click()})),n.addEventListener("change",(e=>{const t=e.target.files[0];if(!t)return;const a=new FileReader;a.onload=e=>{try{const t=JSON.parse(e.target.result);if(!t.produk||!t.nota||!t.pengaturanToko)throw new Error("Format file tidak valid");localStorage.setItem("produk",JSON.stringify(t.produk)),localStorage.setItem("nota",JSON.stringify(t.nota)),localStorage.setItem("pengaturanToko",JSON.stringify(t.pengaturanToko)),Swal.fire({title:"Import Berhasil",text:"Data berhasil diimpor! Halaman akan direfresh.",icon:"success",confirmButtonText:"OK"}).then((()=>location.reload()))}catch(e){Swal.fire({title:"Error",text:"Gagal mengimport data : "+e.message,icon:"error",confirmButtonText:"OK"})}},a.onerror=()=>{Swal.fire({title:"Error",text:"Gagal membaca file",icon:"error",confirmButtonText:"OK"})},a.readAsText(t)})),a.addEventListener("click",(()=>{Swal.fire({title:"Konfirmasi Reset Data",text:"Apakah Anda yakin ingin mereset semua data? Semua data akan dihapus permanen!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Ya, Reset!",cancelButtonText:"Batal"}).then((e=>{e.isConfirmed&&(localStorage.clear(),Swal.fire({title:"Reset Berhasil",text:"Data berhasil direset. Halaman akan direfresh.",icon:"success",confirmButtonText:"OK"}).then((()=>location.reload())))}))}))}));